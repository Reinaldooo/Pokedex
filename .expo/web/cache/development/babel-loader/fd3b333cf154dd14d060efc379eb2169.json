{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _taggedTemplateLiteralLoose from \"@babel/runtime/helpers/taggedTemplateLiteralLoose\";\nvar _jsxFileName = \"/Users/reinaldo/Desktop/Apps/pokedex/screens/Main.js\";\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteralLoose([\"\\n  background-color: rgb(229, 229, 234);\\n  padding: 0 30px;\\n  height: 103%;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useState, useRef, useEffect } from \"react\";\nimport styled from \"styled-components/native\";\nimport { SafeAreaView } from \"react-native-safe-area-context\";\nimport { dbSetupHelper } from \"../utils\";\nimport { executeSql } from \"../dbUtils\";\nimport PokemonList from \"../components/PokemonList\";\nimport SearchBar from \"../components/SearchBar\";\nvar PokemonListWrapper = styled.View(_templateObject());\nexport default function Main(_ref) {\n  var navigation = _ref.navigation;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      pokeDb = _useState2[0],\n      setPokeDb = _useState2[1];\n\n  var _useState3 = useState(102),\n      _useState4 = _slicedToArray(_useState3, 2),\n      dbOffset = _useState4[0],\n      setDbOffset = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      preventScrollToIndex = _useState6[0],\n      setPreventScrollToIndex = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      showBackToTop = _useState8[0],\n      setShowBackToTop = _useState8[1];\n\n  var _useState9 = useState(\"\"),\n      _useState10 = _slicedToArray(_useState9, 2),\n      searchChars = _useState10[0],\n      setSearchChars = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      searching = _useState12[0],\n      setSearching = _useState12[1];\n\n  var flatRef = useRef(null);\n  useEffect(function () {\n    executeSql(\"create table if not exists pokemon (id integer not null, \" + \"name text, types text, sprite text, color text, desc text, \" + \"evolution_chain text, owned int);\");\n    executeSql(\"select * from pokemon;\").then(function (res) {\n      console.log(res[10]);\n\n      if (res.length === 0) {\n        dbSetupHelper.forEach(function (item) {\n          executeSql(\"insert into pokemon (id, name, types, sprite, color, desc, \" + \"evolution_chain, owned) values (?, ?, ?, ?, ?, ?, ?, ?)\", [item.id, item.name, JSON.stringify(item.types), item.sprite, item.color, item.desc, item.evolution_chain, item.owned]);\n        });\n      }\n    });\n    executeSql(\"select * from pokemon limit 102;\").then(function (res) {\n      return setPokeDb(res);\n    });\n  }, []);\n  useEffect(function () {\n    if (pokeDb.length !== 0 && !preventScrollToIndex) {\n      flatRef.current.scrollToIndex({\n        index: 0\n      });\n    }\n  }, [pokeDb]);\n\n  var search = function search(query) {\n    if (!query) return;\n    executeSql(\"select * from pokemon where name like ?;\", [\"%\" + query + \"%\"]).then(function (matches) {\n      if (matches.length % 3 !== 0) {\n        matches.push({\n          name: \"hidden\",\n          sprite: \"hidden\",\n          color: \"hidden\"\n        });\n      }\n\n      console.log(matches);\n      setSearching(true);\n      setSearchChars(query);\n      setPokeDb(matches);\n    });\n  };\n\n  var reset = function reset() {\n    executeSql(\"select * from pokemon limit 102;\").then(function (res) {\n      setPokeDb(res);\n      setSearching(false);\n      setSearchChars(\"\");\n      setDbOffset(102);\n    });\n  };\n\n  var loadMore = function loadMore() {\n    if (dbOffset > 750 || searching) return;\n    executeSql(\"select * from pokemon limit 54 offset ?;\", [dbOffset]).then(function (res) {\n      setPreventScrollToIndex(true);\n      setPokeDb(function (old) {\n        return old.concat(res);\n      });\n      setDbOffset(function (old) {\n        return old + 54;\n      });\n\n      if (dbOffset > 200) {\n        setShowBackToTop(true);\n      }\n    });\n  };\n\n  var backToTop = function backToTop() {\n    flatRef.current.scrollToIndex({\n      index: 0\n    });\n    setShowBackToTop(false);\n    setTimeout(function () {\n      executeSql(\"select * from pokemon limit 102;\").then(function (reset) {\n        setPokeDb(res);\n        setDbOffset(102);\n      });\n    }, 300);\n  };\n\n  return React.createElement(SafeAreaView, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 5\n    }\n  }, React.createElement(PokemonListWrapper, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }\n  }, React.createElement(SearchBar, {\n    search: search,\n    reset: reset,\n    searching: searching,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 9\n    }\n  }), React.createElement(PokemonList, {\n    items: pokeDb,\n    flatRef: flatRef,\n    navigation: navigation,\n    searchChars: searchChars,\n    loadMore: loadMore,\n    reset: reset,\n    backToTop: backToTop,\n    showBackToTop: showBackToTop,\n    searching: searching,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 9\n    }\n  })));\n}","map":{"version":3,"sources":["/Users/reinaldo/Desktop/Apps/pokedex/screens/Main.js"],"names":["React","useState","useRef","useEffect","styled","SafeAreaView","dbSetupHelper","executeSql","PokemonList","SearchBar","PokemonListWrapper","View","Main","navigation","pokeDb","setPokeDb","dbOffset","setDbOffset","preventScrollToIndex","setPreventScrollToIndex","showBackToTop","setShowBackToTop","searchChars","setSearchChars","searching","setSearching","flatRef","then","res","console","log","length","forEach","item","id","name","JSON","stringify","types","sprite","color","desc","evolution_chain","owned","current","scrollToIndex","index","search","query","matches","push","reset","loadMore","old","concat","backToTop","setTimeout"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport styled from \"styled-components/native\";\nimport { SafeAreaView } from \"react-native-safe-area-context\";\n//\nimport { dbSetupHelper } from \"../utils\";\nimport { executeSql } from \"../dbUtils\";\nimport PokemonList from \"../components/PokemonList\";\nimport SearchBar from \"../components/SearchBar\";\n\nconst PokemonListWrapper = styled.View`\n  background-color: rgb(229, 229, 234);\n  padding: 0 30px;\n  height: 103%;\n`;\n\nexport default function Main({ navigation }) {\n  const [pokeDb, setPokeDb] = useState([]);\n  const [dbOffset, setDbOffset] = useState(102);\n  const [preventScrollToIndex, setPreventScrollToIndex] = useState(false);\n  const [showBackToTop, setShowBackToTop] = useState(false);\n  const [searchChars, setSearchChars] = useState(\"\");\n  const [searching, setSearching] = useState(false);\n  const flatRef = useRef(null);\n\n  useEffect(() => {\n    executeSql(\n      \"create table if not exists pokemon (id integer not null, \" +\n        \"name text, types text, sprite text, color text, desc text, \" +\n        \"evolution_chain text, owned int);\"\n    );\n    executeSql(`select * from pokemon;`).then((res) => {\n      console.log(res[10])\n      if (res.length === 0) {\n        dbSetupHelper.forEach((item) => {\n          executeSql(\n            \"insert into pokemon (id, name, types, sprite, color, desc, \" +\n              \"evolution_chain, owned) values (?, ?, ?, ?, ?, ?, ?, ?)\",\n            [\n              item.id,\n              item.name,\n              JSON.stringify(item.types),\n              item.sprite,\n              item.color,\n              item.desc,\n              item.evolution_chain,\n              item.owned,\n            ]\n          );\n        });\n      }\n    });\n    executeSql(`select * from pokemon limit 102;`).then((res) =>\n      setPokeDb(res)\n    );\n  }, []);\n\n  useEffect(() => {\n    // Scroll to top if db is changed\n    if (pokeDb.length !== 0 && !preventScrollToIndex) {\n      flatRef.current.scrollToIndex({ index: 0 });\n    }\n  }, [pokeDb]);\n\n  const search = (query) => {\n    if (!query) return;\n    executeSql(\"select * from pokemon where name like ?;\", [`%${query}%`]).then(\n      (matches) => {\n        if (matches.length % 3 !== 0) {\n          // Insert a empty item to fix last column layout if the cards number is\n          // not multiple of 3\n          matches.push({\n            name: \"hidden\",\n            sprite: \"hidden\",\n            color: \"hidden\",\n          });\n        }\n        console.log(matches)\n        setSearching(true);\n        setSearchChars(query);\n        setPokeDb(matches);\n      }\n    );\n  };\n\n  const reset = () => {\n    executeSql(`select * from pokemon limit 102;`).then((res) => {\n      setPokeDb(res);\n      setSearching(false);\n      setSearchChars(\"\");\n      setDbOffset(102);\n    });\n  };\n\n  const loadMore = () => {\n    if (dbOffset > 750 || searching) return;\n    executeSql(`select * from pokemon limit 54 offset ?;`, [dbOffset])\n    .then((res) => {\n      setPreventScrollToIndex(true);\n      setPokeDb((old) => old.concat(res));\n      setDbOffset((old) => old + 54);\n      if (dbOffset > 200) {\n        setShowBackToTop(true);\n      }\n    })\n  };\n\n  const backToTop = () => {\n    flatRef.current.scrollToIndex({ index: 0 });\n    setShowBackToTop(false);\n    // After 300ms reset the state for performance optimization\n    setTimeout(() => {\n      executeSql(`select * from pokemon limit 102;`)\n      .then((reset) => {\n        setPokeDb(res);\n        setDbOffset(102);\n      })\n    }, 300);\n  };\n\n  return (\n    <SafeAreaView>\n      <PokemonListWrapper>\n        <SearchBar search={search} reset={reset} searching={searching} />\n        <PokemonList\n          items={pokeDb}\n          flatRef={flatRef}\n          navigation={navigation}\n          searchChars={searchChars}\n          loadMore={loadMore}\n          reset={reset}\n          backToTop={backToTop}\n          showBackToTop={showBackToTop}\n          searching={searching}\n        />\n      </PokemonListWrapper>\n    </SafeAreaView>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}